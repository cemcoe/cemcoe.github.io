(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{329:function(t,s,a){"use strict";a.r(s);var n=a(28),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Koa 是由 Express 原班人马打造的 web 框架。")]),t._v(" "),a("h2",{attrs:{id:"初体验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初体验"}},[t._v("#")]),t._v(" 初体验")]),t._v(" "),a("p",[t._v("第一步当然是安装了，直接搞。")]),t._v(" "),a("div",{staticClass:"language-md extra-class"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("npm install koa\n")])])]),a("p",[t._v("创建一个名为 "),a("code",[t._v("app.js")]),t._v(" 的入口测试文件。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.js")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 导入koa，一般操作，包装过的http")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建一个 http 服务器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里是干什么的，暂时打个问号？")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cemcoe'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听当前机器地址端口，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动服务后就可以通过 http://127.0.0.1:80 访问")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("作为一个 web 框架，Koa 帮我们做了什么？")]),t._v(" "),a("p",[t._v("从后端的角度看从客户端发请求到看到内容的过程。")]),t._v(" "),a("p",[t._v("服务器：接收到来自前端的请求(request) => 处理请求，查表并进行数据处理 => 生成数据 => 将数据发送的客户端(response)。")]),t._v(" "),a("p",[t._v("有了 Koa 后，Koa: request => middlewares => response")]),t._v(" "),a("p",[t._v("Koa 帮我们做了头和尾，帮我们处理了请求，发送数据，但中间的查表，数据处理等还是要我们来完成，也就是说，编码的重点在中间件上。")]),t._v(" "),a("p",[t._v("我们的工作是处理中间文件，上面的例子的核心代码如下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 中间件，重点关注")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ctx ： koa 处理好的对象")]),t._v("\n  ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cemcoe'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("这里的 ctx 和 next 是干什么的？")]),t._v(" "),a("ul",[a("li",[t._v("ctx: koa 处理好的对象")]),t._v(" "),a("li",[t._v("next: 迭代器，控制流程顺序")])]),t._v(" "),a("h2",{attrs:{id:"一些常用的api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一些常用的api"}},[t._v("#")]),t._v(" 一些常用的API")]),t._v(" "),a("p",[t._v("前面已经初步尝试了 Koa 的写法，遇到了 "),a("code",[t._v("ctx")]),t._v(" api，不妨看一看在开发中会经常用到的 api。\n首先是 "),a("code",[t._v("ctx")]),t._v("，作为对象，看一看里面还有些什么？")]),t._v(" "),a("ul",[a("li",[t._v("ctx.request")]),t._v(" "),a("li",[t._v("ctx.response")]),t._v(" "),a("li",[t._v("ctx.state 命名空间，类似于 Vuex")])]),t._v(" "),a("p",[t._v("需要注意的是 "),a("code",[t._v("ctx.request")]),t._v(" "),a("code",[t._v("ctx.response")]),t._v(" 的访问器可以省略掉"),a("code",[t._v("request")]),t._v(" "),a("code",[t._v("response")]),t._v("，什么意思嘞？")]),t._v(" "),a("div",{staticClass:"language-md extra-class"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("ctx.request.method === ctx.method\nctx.response.body === ctx.body\n")])])]),a("p",[t._v("刚开始学习时，省略掉这些容易懵，别问我是怎么知道的。")]),t._v(" "),a("p",[t._v("总会陷入到这个玩意究竟是 "),a("code",[t._v("request")]),t._v(" 身上的还是 "),a("code",[t._v("response")]),t._v(" 身上的？")]),t._v(" "),a("h2",{attrs:{id:"常用中间价"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用中间价"}},[t._v("#")]),t._v(" 常用中间价")]),t._v(" "),a("p",[t._v("前面说过，中间件是编码的重点，这里有一些已经封装好的中间件，可以直接拿来使用。")]),t._v(" "),a("ul",[a("li",[t._v("koa-static-cache 静态文件代理服务")]),t._v(" "),a("li",[t._v("koa-router 路由")]),t._v(" "),a("li",[t._v("koa-swing 模板引擎")]),t._v(" "),a("li",[t._v("koa-bodyparser body 解析")])]),t._v(" "),a("p",[t._v("下面挑几个试一试。")]),t._v(" "),a("h3",{attrs:{id:"静态资源模块-static-cache"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态资源模块-static-cache"}},[t._v("#")]),t._v(" 静态资源模块 static-cache")]),t._v(" "),a("p",[t._v("处理静态文件如图片等，使用前先安装是基本操作。")]),t._v(" "),a("div",{staticClass:"language-md extra-class"},[a("pre",{pre:!0,attrs:{class:"language-md"}},[a("code",[t._v("npm install koa-static-cache\n")])])]),a("p",[t._v("如何使用嘞？")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" koaStaticCache "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-static-cache'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 中间件")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("koaStaticCache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" __dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/static'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果请求的 url 以 /static 开始，则为静态文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("此时如果有 "),a("code",[t._v("./index.html")]),t._v(" 那么就可以到 "),a("code",[t._v("http://127.0.0.1/static/index.html")]),t._v(" 地址看到该静态文件。")]),t._v(" "),a("h3",{attrs:{id:"koa-router"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa-router"}},[t._v("#")]),t._v(" koa-router")]),t._v(" "),a("p",[t._v("RESTful 中 url 的设计，使用 http 中的 method 来表述动作。")]),t._v(" "),a("ul",[a("li",[t._v("POST: http://127.0.0.1/user 新增用户")]),t._v(" "),a("li",[t._v("GET: http://127.0.0.1/user/1 查询用户")]),t._v(" "),a("li",[t._v("DELETE: http://127.0.0.1/user/1 删除用户")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Router "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-router'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过 get 请求 发送 / 请求 => https://127.0.0.1/")]),t._v("\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'访问根目录'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 把路由挂载到 app 对象，这一步很容易遗忘")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("hr"),t._v(" "),a("p",[t._v("常用的中间件还有 koa-swig 模板引擎，在 Hexo 已经感受到了模板引擎的玩法。至于 koa-bodyparser 这里也先不多介绍。")]),t._v(" "),a("p",[t._v("对于 Koa 的初体验就是这样了。")])])}),[],!1,null,null,null);s.default=e.exports}}]);