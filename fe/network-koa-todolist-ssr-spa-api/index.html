<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>化学小子的前端实验册</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="manifest" href="/fe/manifest.json">
    <meta name="description" content="化学小子的前端实验册，记录学习中遇到的各种坑">
    <meta name="theme-color" content="#3eaf7c">
    <link rel="preload" href="/fe/assets/css/0.styles.2d25daf9.css" as="style"><link rel="preload" href="/fe/assets/js/app.d7dafe9a.js" as="script"><link rel="preload" href="/fe/assets/js/2.11505e39.js" as="script"><link rel="preload" href="/fe/assets/js/13.107f4d99.js" as="script"><link rel="prefetch" href="/fe/assets/js/10.30bda224.js"><link rel="prefetch" href="/fe/assets/js/11.3bde3ae5.js"><link rel="prefetch" href="/fe/assets/js/12.188fe2ef.js"><link rel="prefetch" href="/fe/assets/js/14.80a3bf87.js"><link rel="prefetch" href="/fe/assets/js/15.5e4555bd.js"><link rel="prefetch" href="/fe/assets/js/16.b3e4683b.js"><link rel="prefetch" href="/fe/assets/js/17.071c6be3.js"><link rel="prefetch" href="/fe/assets/js/18.27fa6860.js"><link rel="prefetch" href="/fe/assets/js/19.3412c1de.js"><link rel="prefetch" href="/fe/assets/js/20.f71cdd35.js"><link rel="prefetch" href="/fe/assets/js/21.acdb0eea.js"><link rel="prefetch" href="/fe/assets/js/22.1705f624.js"><link rel="prefetch" href="/fe/assets/js/23.1123b156.js"><link rel="prefetch" href="/fe/assets/js/24.5b6c3a1c.js"><link rel="prefetch" href="/fe/assets/js/25.faa8d474.js"><link rel="prefetch" href="/fe/assets/js/26.ab961ef0.js"><link rel="prefetch" href="/fe/assets/js/27.856176de.js"><link rel="prefetch" href="/fe/assets/js/28.e244d69a.js"><link rel="prefetch" href="/fe/assets/js/29.93d05a8a.js"><link rel="prefetch" href="/fe/assets/js/3.df576d5f.js"><link rel="prefetch" href="/fe/assets/js/30.dd5bacfd.js"><link rel="prefetch" href="/fe/assets/js/31.c9fe58cc.js"><link rel="prefetch" href="/fe/assets/js/4.9bcf4db0.js"><link rel="prefetch" href="/fe/assets/js/5.912b70e7.js"><link rel="prefetch" href="/fe/assets/js/6.28535f8c.js"><link rel="prefetch" href="/fe/assets/js/7.6dcbfed5.js"><link rel="prefetch" href="/fe/assets/js/8.ff512c9c.js"><link rel="prefetch" href="/fe/assets/js/9.61644727.js">
    <link rel="stylesheet" href="/fe/assets/css/0.styles.2d25daf9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe/" class="home-link router-link-active"><!----> <span class="site-name">化学小子的前端实验册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/front-end-data-collation-and-learning-records/" class="nav-link">
  前端资料整理及学习记录
</a></li><li class="dropdown-item"><!----> <a href="/fe/front-end-adventure-roadmap/" class="nav-link">
  前端探险路线图
</a></li><li class="dropdown-item"><!----> <a href="/fe/the-note-of-professional-javascript-for-web-developers/" class="nav-link">
  读JavaScript高级程序设计
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/css-two-column-layout/" class="nav-link">
  CSS效果 | 两栏布局那些事
</a></li><li class="dropdown-item"><!----> <a href="/fe/css-three-column-layout/" class="nav-link">
  CSS效果 | 三栏布局那些事
</a></li><li class="dropdown-item"><!----> <a href="/fe/css-tab-bar/" class="nav-link">
  CSS效果 | Tab选项卡
</a></li><li class="dropdown-item"><!----> <a href="/fe/css-swiper-picture/" class="nav-link">
  CSS效果 | 轮播图
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/a-few-simple-arithmetic-problems/" class="nav-link">
  JS | 几道简单的数学题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/vue-start-note/" class="nav-link">
  Vue | 入手笔记
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-insert-data-to-dom/" class="nav-link">
  Vue | 如何将数据插入到DOM中
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-insert-data-to-elm-attr/" class="nav-link">
  Vue | 如何将数据插入到元素属性中
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-two-cp-computed-methods-v-if-show/" class="nav-link">
  Vue | computed和methods与v-if和v-show的故事
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-v-on-and-methods/" class="nav-link">
  Vue | v-on和methods的羁绊
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-v-model-and-form/" class="nav-link">
  Vue | v-model和form的羁绊
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-com-base-operation/" class="nav-link">
  Vue | 组件化基本操作
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-com-communication/" class="nav-link">
  Vue | 组件通信
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-com-personal/" class="nav-link">
  Vue | 组件个性化
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-package-a-tabbar-component-from-zero/" class="nav-link">
  Vue | 封装一个tabbar组件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/those-things-of-the-network-requests/" class="nav-link">
  网络请求那些事情
</a></li><li class="dropdown-item"><!----> <a href="/fe/network-mock-data/" class="nav-link">
  如何模拟后端数据
</a></li><li class="dropdown-item"><!----> <a href="/fe/network-axios/" class="nav-link">
  axios那些事
</a></li><li class="dropdown-item"><!----> <a href="/fe/network-koa-todolist-ssr-spa-api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  以todolist为例，看前后端渲染
</a></li><li class="dropdown-item"><!----> <a href="/fe/network-cors-break-origin-from-remove-blog/" class="nav-link">
  从博客迁移看跨域那点事儿
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/node-koa-start-learn/" class="nav-link">
  Koa初体验
</a></li><li class="dropdown-item"><!----> <a href="/fe/node-hexo-template-cemcoe/" class="nav-link">
  如何搞一个专属的 Hexo 的主题
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/front-end-data-collation-and-learning-records/" class="nav-link">
  前端资料整理及学习记录
</a></li><li class="dropdown-item"><!----> <a href="/fe/front-end-adventure-roadmap/" class="nav-link">
  前端探险路线图
</a></li><li class="dropdown-item"><!----> <a href="/fe/the-note-of-professional-javascript-for-web-developers/" class="nav-link">
  读JavaScript高级程序设计
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/css-two-column-layout/" class="nav-link">
  CSS效果 | 两栏布局那些事
</a></li><li class="dropdown-item"><!----> <a href="/fe/css-three-column-layout/" class="nav-link">
  CSS效果 | 三栏布局那些事
</a></li><li class="dropdown-item"><!----> <a href="/fe/css-tab-bar/" class="nav-link">
  CSS效果 | Tab选项卡
</a></li><li class="dropdown-item"><!----> <a href="/fe/css-swiper-picture/" class="nav-link">
  CSS效果 | 轮播图
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/a-few-simple-arithmetic-problems/" class="nav-link">
  JS | 几道简单的数学题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/vue-start-note/" class="nav-link">
  Vue | 入手笔记
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-insert-data-to-dom/" class="nav-link">
  Vue | 如何将数据插入到DOM中
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-insert-data-to-elm-attr/" class="nav-link">
  Vue | 如何将数据插入到元素属性中
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-two-cp-computed-methods-v-if-show/" class="nav-link">
  Vue | computed和methods与v-if和v-show的故事
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-v-on-and-methods/" class="nav-link">
  Vue | v-on和methods的羁绊
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-v-model-and-form/" class="nav-link">
  Vue | v-model和form的羁绊
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-com-base-operation/" class="nav-link">
  Vue | 组件化基本操作
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-com-communication/" class="nav-link">
  Vue | 组件通信
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-com-personal/" class="nav-link">
  Vue | 组件个性化
</a></li><li class="dropdown-item"><!----> <a href="/fe/vue-package-a-tabbar-component-from-zero/" class="nav-link">
  Vue | 封装一个tabbar组件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/those-things-of-the-network-requests/" class="nav-link">
  网络请求那些事情
</a></li><li class="dropdown-item"><!----> <a href="/fe/network-mock-data/" class="nav-link">
  如何模拟后端数据
</a></li><li class="dropdown-item"><!----> <a href="/fe/network-axios/" class="nav-link">
  axios那些事
</a></li><li class="dropdown-item"><!----> <a href="/fe/network-koa-todolist-ssr-spa-api/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  以todolist为例，看前后端渲染
</a></li><li class="dropdown-item"><!----> <a href="/fe/network-cors-break-origin-from-remove-blog/" class="nav-link">
  从博客迁移看跨域那点事儿
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/node-koa-start-learn/" class="nav-link">
  Koa初体验
</a></li><li class="dropdown-item"><!----> <a href="/fe/node-hexo-template-cemcoe/" class="nav-link">
  如何搞一个专属的 Hexo 的主题
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe/network-koa-todolist-ssr-spa-api/#todolist功能拆分" class="sidebar-link">todolist功能拆分</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fe/network-koa-todolist-ssr-spa-api/#后端渲染" class="sidebar-link">后端渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#模板文件编写" class="sidebar-link">模板文件编写</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#设置模板等静态文件的存放位置" class="sidebar-link">设置模板等静态文件的存放位置</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#测试数据" class="sidebar-link">测试数据</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#将数据插到模板文件中" class="sidebar-link">将数据插到模板文件中</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#post请求" class="sidebar-link">POST请求</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#后端渲染总结" class="sidebar-link">后端渲染总结</a></li></ul></li><li><a href="/fe/network-koa-todolist-ssr-spa-api/#前端渲染版本" class="sidebar-link">前端渲染版本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#测试数据-2" class="sidebar-link">测试数据</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#测试数据文件读取" class="sidebar-link">测试数据文件读取</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#无参-get-接口设计" class="sidebar-link">无参 GET 接口设计</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#有参数-post-接口设计" class="sidebar-link">有参数 POST 接口设计</a></li><li class="sidebar-sub-header"><a href="/fe/network-koa-todolist-ssr-spa-api/#前端渲染总结" class="sidebar-link">前端渲染总结</a></li></ul></li><li><a href="/fe/network-koa-todolist-ssr-spa-api/#api接口设计" class="sidebar-link">api接口设计</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>直接说前端渲染和后端渲染的区别，难免进入到对概念的纠结上。
不妨以一个 todolist 例子来看前端渲染 VS 后端渲染的区别。</p> <h2 id="todolist功能拆分"><a href="#todolist功能拆分" class="header-anchor">#</a> todolist功能拆分</h2> <p>抛开前端渲染和后端渲染的技术选型先不谈，对于这个 todolist 小项目进行功能拆分。</p> <ul><li>任务列表展示，展示信息
<ul><li>统计信息（已完成，未完成）</li></ul></li> <li>任务列表的状态变更
<ul><li>添加新任务</li> <li>完成任务</li> <li>取消完成，将任务状态改为未完成</li> <li>删除任务</li></ul></li> <li>用户系统</li></ul> <h2 id="后端渲染"><a href="#后端渲染" class="header-anchor">#</a> 后端渲染</h2> <p>先看后端渲染，又称服务器端渲染，通过页面刷新，表单提交来进行数据更新。</p> <ul><li>首页：/</li> <li>添加：/add</li> <li>任务状态改变：/change/:id</li> <li>删除：/remove:/id</li></ul> <p>发请求时如何带数据？通过 url 中 querystring 传递地址以外的数据。当 methods 为 GET 时，url 中会有 <code>name=表单值</code>。</p> <p>url 长度是有限制的，querystring 也是有限制的，数据量大的内容不推荐 querystring 方式。GET 请求会缓存url，历史记录，会有安全问题。POST 不会放到历史记录里面。</p> <p>后端渲染版本，需要模板进行渲染，输出一个完整的HTML文件。</p> <h3 id="模板文件编写"><a href="#模板文件编写" class="header-anchor">#</a> 模板文件编写</h3> <p>模板文件存放在 views 文件夹中，作为使用过 Hexo 推荐的 ejs 模板语法的人，下面的代码就很好理解了。下面是使用 swig 语法写的模板引擎。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- ./views/index.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  {% for task in datas.tasks %}
  {% if task.done %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>done<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span><span class="token punctuation">&gt;</span></span>
    {{task.id}}--{{task.title}}--{{task.done}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  {% else %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{task.id}}--{{task.title}}--{{task.done}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  {% endif %}
  {% endfor %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>别看模板看上去花里胡哨的，渲染后就是静态的 HTML 文件，百分号啥的就没了。</p> <h3 id="设置模板等静态文件的存放位置"><a href="#设置模板等静态文件的存放位置" class="header-anchor">#</a> 设置模板等静态文件的存放位置</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> Swig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-swig'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> co <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'co'</span><span class="token punctuation">)</span>
<span class="token comment">// 设置模板引擎</span>
app<span class="token punctuation">.</span>context<span class="token punctuation">.</span>render <span class="token operator">=</span> co<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token function">Swig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  root<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/views'</span><span class="token punctuation">,</span>
  autoescape<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  cache<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  ext<span class="token operator">:</span> <span class="token string">'html'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="测试数据"><a href="#测试数据" class="header-anchor">#</a> 测试数据</h3> <p>不妨先将测试数据保存在变量中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token comment">// 存储测试数据，当前数据存储在服务器内存中</span>
<span class="token keyword">let</span> datas <span class="token operator">=</span> <span class="token punctuation">{</span>
  maxId<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  appName<span class="token operator">:</span> <span class="token string">'TodoList'</span><span class="token punctuation">,</span>
  tasks<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'整理一个博客'</span><span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'学习Vue'</span><span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'干撒'</span><span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="将数据插到模板文件中"><a href="#将数据插到模板文件中" class="header-anchor">#</a> 将数据插到模板文件中</h3> <p>将上面定义的数据传到模板文件中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token comment">// 首页，展示任务清单</span>
<span class="token comment">// async await</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    datas
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="post请求"><a href="#post请求" class="header-anchor">#</a> POST请求</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ./views/add.html</span>
<span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;/posttask/&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;POST&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;title&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span>
  
  <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre></div><p>对应的后端代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token comment">// 添加，处理通过添加页面提交的数据</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/posttask'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> title <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>title <span class="token operator">||</span> <span class="token string">''</span>
  <span class="token comment">// ctx.body = '接收提交的新任务' + title</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      msg<span class="token operator">:</span> <span class="token string">'任务添加失败，请输入任务标题'</span><span class="token punctuation">,</span>
      href<span class="token operator">:</span> <span class="token string">'javascript:history.back();'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    datas<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token operator">++</span>datas<span class="token punctuation">.</span>maxId<span class="token punctuation">,</span>
      title<span class="token operator">:</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
      done<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      msg<span class="token operator">:</span> <span class="token string">'任务添加成功'</span><span class="token punctuation">,</span>
      href<span class="token operator">:</span> <span class="token string">'/'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>可以看到后端渲染，使用模板的数据的拼接是由后端完成的。</p> <h3 id="后端渲染总结"><a href="#后端渲染总结" class="header-anchor">#</a> 后端渲染总结</h3> <p>万维网刚开始时就是为了传递文本信息的，内容才是网站的重点，搜索引擎也是喜欢内容的，而网页中的脚本对于部分搜索引擎是无意义的。</p> <p>这样后端渲染就由 SEO 友好的优点了。</p> <p>有一个很熟悉的点就是常用的博客程序其实不管是 Hexo 还是 VuePress 都是将 md 根据博客主题渲染成对应的 HTML 文档，可以从其中领会一些后端渲染的东西。</p> <p>后端渲染思路：</p> <ul><li>请求一个 HTML，模板文件，常用模板引擎 ejs，swig</li> <li>后端查数据库，找到数据</li> <li>服务器根据模板和数据渲染文档</li> <li>服务端将搞好的文档给到客户端</li></ul> <p>缺点，写起来很别扭，百分号很烦。同时占用服务器资源。
后端渲染适合数据变化不大的页面，频繁进行数据更新的页面推荐前端渲染。</p> <h2 id="前端渲染版本"><a href="#前端渲染版本" class="header-anchor">#</a> 前端渲染版本</h2> <p>下面来看一下前端渲染的版本，也是我们熟悉的方式。在今天信息爆炸的时代，数据几乎是实时都在进行着变更。前端渲染，前后端分离不断被提及。</p> <p>简单来说，前端渲染分工更加明确。后端提供 restful 数据接口，前端根据接口请求数据，前端根据从接口拿到的数据对页面进行渲染。</p> <p>前端的工作不再仅仅是写页面，还要有一些数据的处理转化，当然，对于数据的处理还是主要集中在后端。</p> <p>那么问题来了，如何使用 koa 设计一个接口嘞？
首先来看一个接口需要哪些技术。</p> <ol><li>要有接口地址，需要 HTTP 服务，可以架设到服务器或本地--&gt; Koa</li> <li>对于不同的地址返回对应的接口，需要用到后端路由--&gt; koa-router</li> <li>需要解析前端传来的数据--&gt; koa-bodyparser</li> <li>数据增删改查，需要用到数据库语句，作为一个小项目，暂时将数据放到 json 文件中--&gt; mysql ?? json</li> <li>基于将文件存储在json文件中，我们需要对文件进行读取操作--&gt; fs</li></ol> <h3 id="测试数据-2"><a href="#测试数据-2" class="header-anchor">#</a> 测试数据</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;_id&quot;</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token property">&quot;appName&quot;</span><span class="token operator">:</span><span class="token string">&quot;TodoList&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;todos&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre></div><p>主意json的数据格式。</p> <h3 id="测试数据文件读取"><a href="#测试数据文件读取" class="header-anchor">#</a> 测试数据文件读取</h3> <p>为了拿到并更改 json 里的数据我们引入 fs 文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 读文件并转换数据格式</span>
<span class="token keyword">let</span> datas <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./data/data.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 更改json文件</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./data/data.json'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="无参-get-接口设计"><a href="#无参-get-接口设计" class="header-anchor">#</a> 无参 GET 接口设计</h3> <p>来看接口的具体操作，一个接口要有地址，数据，参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/todos'</span><span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ctx.body = {x:1, y:2} =&gt; {&quot;x&quot;: 1, &quot;y&quot;: 2}</span>
  <span class="token comment">// ctx.body = datas.todos</span>

  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> datas<span class="token punctuation">.</span>todos
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>todos 接口是一个简单的没有参数的get请求接口
<img src="/fe/assets/img/todos.b0cf4838.jpg" alt="todos"></p> <h3 id="有参数-post-接口设计"><a href="#有参数-post-接口设计" class="header-anchor">#</a> 有参数 POST 接口设计</h3> <p>下面来一个 POST 请求的例子，来个 BodyParser。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> BodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span>

<span class="token comment">// body 解析</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span> <span class="token function">BodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/toggle'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> id <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id <span class="token operator">||</span> <span class="token number">0</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      code<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token string">'请输入id'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">let</span> todo <span class="token operator">=</span> datas<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span>
  todo<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>done

  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> todo
  <span class="token punctuation">}</span>

  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./data/data.json'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>用这个post接口接收一个id参数，会将该id对应的任务状态改变，有完成改为未完成或者反过来。
用 postman 来发一波请求。
<img src="/fe/assets/img/post-toggle.a674c063.gif" alt="toggle"></p> <p>就这？</p> <p>前端如何根据接口地址进行渲染这里就不多说了，毕竟是前端熟悉的地方了。</p> <h3 id="前端渲染总结"><a href="#前端渲染总结" class="header-anchor">#</a> 前端渲染总结</h3> <p>在前端渲染下，前端请求数据，用户更改数据后前端将数据发到后端，后端对数据进行相应的更改后将更新的数据给到前端，前端根据数据更新页面。</p> <p>两者在数据填充上有很大的区别，后端渲染直接将数据填充到 HTML 后传给前端，前端渲染则是通过 fetch || ajax || axios 等从后台接口拿数据再自己填充或进行其他数据操作，进而渲染界面。</p> <p>和后端渲染相比更麻烦了有没有？
<img src="/fe/assets/img/todolist.dd915cc8.gif" alt="demo"></p> <hr> <h2 id="api接口设计"><a href="#api接口设计" class="header-anchor">#</a> api接口设计</h2> <p>开发前沟通好接口的数据结构
开发前沟通好接口的数据结构
开发前沟通好接口的数据结构</p> <p>不要一上来就莽代码。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/15/2020, 12:42:52 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/fe/assets/js/app.d7dafe9a.js" defer></script><script src="/fe/assets/js/2.11505e39.js" defer></script><script src="/fe/assets/js/13.107f4d99.js" defer></script>
  </body>
</html>
