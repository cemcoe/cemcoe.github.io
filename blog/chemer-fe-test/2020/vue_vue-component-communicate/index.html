<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>Vue | 组件化 | 组件通信 | 化学小子的前端实验册</title>
    
<link rel="stylesheet" href="../../static/css/post.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>

    <div id="book-nav">
        <button class="open-chapter">
            目录
        </button>
        <a class="book-info" href="../../index.html">
            <span class="nameoneline">化学小子的前端实验册</span>
        </a>
    </div>
    <article class="post">
        <div class="post-title">
            <h2 class="title">Vue | 组件化 | 组件通信</h2>
        </div>
        <div class="article-info">
            <div class="meta">

                
                <span class="tags">Vue</span>
                

                <span class="post-time">2020-03-08</span>
            </div>
        </div>
        <div class="note-content">
            <p>在前后端分离时数据传输的流向：</p>
<ul>
<li>父组件向服务器接口请求数据</li>
<li>子组件向父组件请求本组件数据</li>
<li>父组件监听子组件发生的事情并做响应的处理</li>
</ul>
<p>通信问题就是如何沟通，如何唠嗑的问题。</p>
<p>不如来看以下细胞信号传输：细胞如何相互沟通。</p>
<blockquote>
<p>传送和接收这些信息所需的网络很复杂。这是由一支信使分子军队组成，跨细胞和在细胞之间传输信号（传讯分子）。它们寻找接收信号的目标（受体），最后，信使和受体相互作用，使细胞产生了最终的结果（细胞对原始信号做出回应）。</p>
</blockquote>
<p><a href="https://askthescientists.com/zh-hans/qa/what-is-cell-signaling/" target="_blank" rel="noopener">https://askthescientists.com/zh-hans/qa/what-is-cell-signaling/</a></p>
<p>也就是说，通信是需要两方共同参与，谁发出？传给谁？</p>
<hr>
<p>瞎掰结束，来看 Vue 中的组件通信。</p>
<p>最上层的组件从服务器请求数据，每个子组件向父组件请求自己所需的数据。</p>
<p>不要跨级请求数据，浪费数据请求。</p>
<p>关键指令：</p>
<ul>
<li>父传子 <code>props</code></li>
<li>子传父 自定义事件 <code>$emit</code> event</li>
</ul>
<p>来个 DNA 检测确认父子关系，传信息前肯定是要确定对方身份的，将信息传给敌方就尴尬了。</p>
<blockquote>
<p>陈佩斯：（从台侧上）队长——别开抢！是我！（然后像电线竿立着）<br>朱时茂：哦——你小子。说话！是你把敌人引到这儿来的？（陈佩斯不做声）<br>朱时茂：你说话呀！<br>陈佩斯：你们家电线杆子能说话吗！<br>朱时茂：你这个……台词还是要说的嘛！<br>陈佩斯：让说就说呗。<br>朱时茂：你千万记得啊！只要我掏出枪来一抬手——<br>陈佩斯：怎么着？<br>朱时茂：你就倒下。<br>陈佩斯：为什么？<br>朱时茂：这表示我的枪法准啊！</p>
</blockquote>
<p>来理一理下面的组件关系:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"cpn"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;&#123;goods&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">//----data----</span><br><span class="line">const cpn = &#123;</span><br><span class="line">    template: "#cpn"</span><br><span class="line">&#125;</span><br><span class="line">const app = new Vue(&#123;</span><br><span class="line">    el: "#app",</span><br><span class="line">    data: &#123;</span><br><span class="line">        goods: ['腊肉', "肥肠", "咸鸭蛋"]</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">        cpn</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>app 是 cpn 的父组件，现在的需求是儿子 cpn 向爸爸 app 要物资，即 goods 列表。</p>
<p>怎么要？打电话还是发短信。</p>
<p>怎么传，电报？</p>
<p>传递信息需要双发的共同努力，父组件发送，子组件接收。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cpn</span> <span class="attr">v-bind:cgoods</span>=<span class="string">"goods"</span>&gt;</span><span class="tag">&lt;/<span class="name">cpn</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"cpn"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;cgoods&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> cpn = &#123;</span></span><br><span class="line"><span class="actionscript">        template: <span class="string">"#cpn"</span>,</span></span><br><span class="line"><span class="actionscript">        props: [<span class="string">"cgoods"</span>],</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">        el: <span class="string">"#app"</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="actionscript">            goods: [<span class="string">'腊肉'</span>, <span class="string">"肥肠"</span>, <span class="string">"咸鸭蛋"</span>]</span></span><br><span class="line">        &#125;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            cpn</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过 <code>&lt;cpn v-bind:cgoods=&quot;goods&quot;&gt;&lt;/cpn&gt;</code> 将父子组件连接，子组件通过 props 接收父组件传来的数据。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/3750332-4ff34393e8bba989.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="爸，我要吃的"></p>
<p>下面来理智分析（瞎掰）一波。</p>
<p>过年回家，家里 准备了很多的过年的物资<code>data·</code>，儿子回到了老父亲的家里 <code>app</code> 过年，<br>临走时父亲从自己的背包 <code>goods</code> 中拿出很多儿子想吃的塞到了儿子的背包 <code>cgoods</code>里。</p>
<p>父子分别，儿子到自己的家 <code>cpn</code> 后，从背包里拿出老父亲给自己塞的腊肉咸鸭蛋，开始准备今天的晚饭 <code></code>。</p>
<p>这真是一个温情的故事。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/3750332-3aa71673723a340d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="温情"></p>
<p>父子传递信息大概就是这么个意思。</p>
<p>至于如何处理数据（腊肉啥的）这里就不搞了。</p>
<hr>
<p>逻辑理通后来看一波零碎的知识。</p>
<p>有点 TypeScript 的影子，类型限制和默认值，‘来波TypeScript 代码，TypeScript 搞起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">    cgoods: &#123;</span><br><span class="line">        type: String,</span><br><span class="line">        default: &quot;烤肠&quot;,</span><br><span class="line">        required: true</span><br><span class="line">        &#x2F;&#x2F; 必须传值</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是说可以对 props 的接收数据可以进行类型限制，确定默认值等。</p>
<hr>
<p>反过来看一下子传父的过程。<br><img src="https://upload-images.jianshu.io/upload_images/3750332-4eb4b20b099335be.gif?imageMogr2/auto-orient/strip" alt="换个角度"></p>
<p>子组件发生事件，父组件要知道，比如人生大事结婚订婚等。</p>
<p>家人是坚强后盾。</p>
<p>先让自己知道自己发生了什么事情？？？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;cpn&gt;&lt;&#x2F;cpn&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;template id&#x3D;&quot;cpn&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;button </span><br><span class="line">        v-for&#x3D;&quot;item in categories&quot;</span><br><span class="line">        @click&#x3D;&quot;btnClick(item)&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;button&gt; </span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;---data---</span><br><span class="line"></span><br><span class="line">const cpn &#x3D; &#123;</span><br><span class="line">    template: &quot;#cpn&quot;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            categories: [</span><br><span class="line">                &#123;id: 001, name: &quot;评论&quot;&#125;,</span><br><span class="line">                &#123;id: 002, name: &quot;简信&quot;&#125;,</span><br><span class="line">                &#123;id: 003, name: &quot;投稿请求&quot;&#125;,</span><br><span class="line">                &#123;id: 004, name: &quot;喜欢和赞&quot;&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        btnClick(item) &#123;</span><br><span class="line">            console.log(item)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">const app &#x3D; new Vue(&#123;</span><br><span class="line">    el: &quot;#app&quot;,</span><br><span class="line">    data: &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">        cpn</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>首先儿子要先知道自己目前的状况，发生了什么事情。这里就要用到事件监听。要用到 <a href="https://www.jianshu.com/p/b2aa1eeb30c7" target="_blank" rel="noopener">@click &amp;&amp; method</a> 一对基友。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/3750332-298202b5d1a0e2fa.gif?imageMogr2/auto-orient/strip" alt="时刻关注自身的状况"></p>
<p>问题来了，如何将自己的近况及时告诉自己的父母，父母知道儿子的近况以后做出相应的回应，或放心，或担心，或嘱咐添加衣物按时吃饭，不要累着。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;cpn v-on:item-click&#x3D;&quot;cpnClick&quot;&gt;&lt;&#x2F;cpn&gt;</span><br><span class="line">    &lt;!-- 4. 得到孩子的近况 --&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;template id&#x3D;&quot;cpn&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;button </span><br><span class="line">        v-for&#x3D;&quot;item in categories&quot;</span><br><span class="line">        @click&#x3D;&quot;btnClick(item)&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;button&gt; </span><br><span class="line">        &lt;!-- 1. 时刻关注自己的状况 --&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    const cpn &#x3D; &#123;</span><br><span class="line">        template: &quot;#cpn&quot;,</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                categories: [</span><br><span class="line">                    &#123;id: 001, name: &quot;饿了&quot;&#125;,</span><br><span class="line">                    &#123;id: 002, name: &quot;没钱了&quot;&#125;,</span><br><span class="line">                    &#123;id: 003, name: &quot;有女朋友了&quot;&#125;,</span><br><span class="line">                    &#123;id: 004, name: &quot;结婚了&quot;&#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            btnClick(item) &#123;</span><br><span class="line">                console.log(item)</span><br><span class="line">                &#x2F;&#x2F; 2. 我发生了什么事情</span><br><span class="line">                this.$emit(&#39;item-click&#39;, item)</span><br><span class="line">                &#x2F;&#x2F; 3. 告诉父母我发生了什么事情</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    const app &#x3D; new Vue(&#123;</span><br><span class="line">        el: &quot;#app&quot;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            cpnClick(item) &#123;</span><br><span class="line">                console.log(&quot;老子知道你小子的事情了 | &quot;, item.name)</span><br><span class="line">                &#x2F;&#x2F; 5. 对孩子的近况做出响应</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            cpn</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>将在子组件监听到的事件通过 <code>$emit</code> 传出去，通过 <code>&lt;cpn v-on:item-click=&quot;cpnClick&quot;&gt;&lt;/cpn&gt;</code> 将两者连接，父组件在自己的 <code>methods</code> 中实现对应的响应逻辑。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/3750332-bf9f00d13eaca159.gif?imageMogr2/auto-orient/strip" alt="子父.gif"></p>
<p>捋一捋大概是这样：</p>
<ul>
<li><ol>
<li>时刻关注自己的状况</li>
</ol>
</li>
<li><ol start="2">
<li>我发生了什么事情</li>
</ol>
</li>
<li><ol start="3">
<li>告诉父母我发生了什么事情</li>
</ol>
</li>
<li><ol start="4">
<li>得到孩子的近况</li>
</ol>
</li>
<li><ol start="5">
<li>对孩子的近况做出相应</li>
</ol>
</li>
</ul>
<p>子传递父组件流程图：<br><img src="https://upload-images.jianshu.io/upload_images/3750332-2f0f7e4e1bfe4163.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="子传父流程图"></p>
<p>来一波总结：</p>
<ul>
<li>父传子 <code>props</code></li>
<li>子传父 自定义事件 <code>$emit</code></li>
</ul>
<blockquote>
<p>每天一遍提醒自己增强自身抵抗力，多喝热水，注意身体。</p>
</blockquote>
<blockquote>
<p>这里是 cemcoe 的连载 <a href="https://www.jianshu.com/nb/40206736" target="_blank" rel="noopener">化学小子的前端实验册</a> 的第 22 篇，欢迎关注。</p>
</blockquote>

            <p>> 这里是 cemcoe 连载 [化学小子的前端实验册] 的第 8 篇，欢迎关注。</p>
            <p>> 每天一遍提醒自己增强自身抵抗力，多喝热水，注意身体。</p>
        </div>
    </article>
    <!-- 我是章节目录  -->
    <div id="book-chapters">
        <div class="book-chapters-header">
            <span class="title">目录(共11篇)</span>
            <button class="reset">切换顺序</button>
        </div>
        --------

        
        
        
            
        <ul>
            <li><a href="../hexo_how-to-make-a-hexo-theme-index/index.html">0---如何搞一个专属的 Hexo 的主题 | 首页篇</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../hexo_how-to-make-a-hexo-theme-post/index.html">---如何搞一个专属的 Hexo 主题 | 文章篇</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../vue-insert-data-to-attribute/index.html">3---Vue | 如何将数据插入到属性中</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../vue-insert-data-to-dom/index.html">2---Vue | 如何将数据插入到DOM中</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../vue-two-boys/index.html">5---Vue | 事件监听的两个小伙伴</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../vue-two-cp-methods-and-computed-or-vif-and-vshow/index.html">4---Vue | 两对cp methods && computed || v-if && v-show</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../vue-vmodel-and-form/index.html">6---Vue | v-model && form</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../vue_start-learn-vue/index.html">1---Vue 入手</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../vue_vue-component-base-operation/index.html">7---Vue | 组件化 | 基本操作</a></li>
        </ul>
        
            
        <ul>
            <li><a href="">8---Vue | 组件化 | 组件通信</a></li>
        </ul>
        
            
        <ul>
            <li><a href="../vue_vue-component-personal/index.html">9---Vue | 组件化 | 个性化组件slot</a></li>
        </ul>
        
        <div class="book-chapters-drawer-footer">
            <a href="../../index.html">前往作品主页</a>
        </div>


    </div>
    <!-- 111 -->
    
<script src="../../static/js/index.js"></script>


</body>

</html>